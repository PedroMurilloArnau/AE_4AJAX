<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
 <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <!--<script type="text/javascript" src="JS/validacionJQ.js"></script>-->
    <script type="text/javascript" src="js/jquery-3.5.1.min.js"></script>
    <title>PazzetoTrocala JQuery</title>
    <script type="text/javascript">

    const URL_DESTINO = "http://localhost/AE_4AJAX/"
    const RECURSO = "ingredientes.json"

    $("#formulario").submit(validacionJQ())
    $(cargarinfo)

    function cargarinfo(){
        $("#JQuery").click(peticionAJAX)
        $("#Calc").click(calculprec)
        
    
    }
    
    function peticionAJAX(){
        $.ajax({
                'type'  :   'GET',
                'url'   :   URL_DESTINO + RECURSO,
                'async' :   true,     

        }).done(leerRespuestaQ)//funcion de callback si va bien
        .fail(procesarError)//funcion de callback si va mal
        
    }
    let ingredientess
    let tamaño
    function leerRespuestaQ(ingredientes){
    
    $("#formo").html('')
    
     ingredientess = ingredientes.PIZZERIA.INGREDIENTES;
     tamaño = ingredientes.PIZZERIA.TAMAÑO;
    console.log(tamaño[0].NOMBRE)

    $.each(tamaño,function(i,tam){
        let tr = $(`<label>${tam.NOMBRE}</label>
                <input type="radio" id ="${tam.NOMBRE}" class="tamaño"
                 name="tamaño" value="${tam.VALUE}"
                >`)
        tr.appendTo("#formo")
    

    })
    $("</br>").appendTo("#formo")
    $.each(ingredientess,function(i,ind){
        let tr = $(`<label>${ind.NOMBRE}</label>
                <input type="checkbox" id ="${ind.NOMBRE}" 
                class="checkbox" name="${ind.NOMBRE}" value="s"
                >`)
        tr.appendTo("#formo")
    

    })
    }
    function procesarError(error){
    alert("ZASCA!")
    console.log(error)
    }

    function calculprec(){
        $("#prec").html('')
    
    var tam = 0
    
    let che = $("[type=radio]")
    for(let x=0; x<che.length; x++){
    if(che[x].checked){
        
     tam = parseInt(tamaño[x].PRECIO)//No se pq no me deja si no lo parseo
    }
}

    
    

    let ched = $("[type=checkbox]")
    for(let x=0; x<ched.length; x++){
        if(ched[x].checked){
        tam = tam + ingredientess[x].PRECIO
        }
    }
    
    $('<h3>La suma total del pedido es de:'+tam+'E.</h3>').appendTo("#prec")
} 
    
</script>

    
</head>

<body>
    <!--Creamos un form-->
    <form id="formulario">
        <h1>Benvenuti alla pizzeria Trocola</h1>
        
        <label>Nombre : </label>
        <input type="text" id="nombre" name="nombre" placeholder="nombre"/>
        </br>
        <label>Direccion : </label>
        <input type="text" id="direccion" name="direccion" placeholder="Dirección"/>
        </br>
        <label>Teléfono (sin el prefijo +34) : </label>
        <input type="number" id="telefono" name="telefono" placeholder="Telefono sin prefijo +34"/>
        </br>
        <label>Email[ ********@*****.(es,com,...)] :</label>
        <input type="text" id="email" name="email" placeholder="De tipo [ ********@*****.(es,com,...)] "/>
        </br>
        <label>Enviar pedido: </label>
        <input id="submit" type="submit"  value="Mandar Formulario">
    </form>
    <p id="reporte"></p>
    <p id="precio_total"></P>
    <table id="resultadoBusqueda"></table>
    <div id="formo">cosa</div>
    <input type="button" id="JQuery" value="CargarJSON Con JQuery">
    <input type="button" id="Calc" value="CargarPRECIO">
    <div id="prec"></div>
</body>
</html>